angular.module("contacts",["ui.router","angularLocalStorage"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){"use strict";$stateProvider.state("contacts",{controller:"ContactsCtrl",templateUrl:"views/contacts.html",url:"/"}).state("contacts.create",{templateUrl:"views/contact.html",url:"create"}).state("contacts.edit",{templateUrl:"views/contact.html",url:":id/edit"}).state("contacts.view",{templateUrl:"views/contact.html",url:":id"}),$urlRouterProvider.otherwise("/")}]),angular.module("contacts").controller("ContactsCtrl",["$filter","$scope","$state","Contacts","States","storage","Validation",function($filter,$scope,$state,Contacts,States,storage,Validation){"use strict";function contactComparator(a,b){var contact=[a,b].map(function(arg){var name=arg.name.split(" ");return{firstName:name[0],lastName:name[1]}});return contact[0].lastName?contact[1].lastName?contact[0].lastName>contact[1].lastName:-1:contact[1].lastName?1:contact[0].firstName>contact[1].firstName}function saveContacts(){storage.set("Contacts",angular.copy($scope.contacts))}$scope.contacts=(storage.get("Contacts")||Contacts).sort(contactComparator),$scope.states=States,$scope.validation=Validation,saveContacts(),$scope.isContactEdited=function(){return!angular.equals($scope.contact,$scope.activeContact)},$scope.saveContact=function(ContactForm){$scope.submitted=!0,ContactForm.$valid&&($scope.contacts[$scope.contact.id]||$scope.contacts.push($scope.contact),saveContacts(),$scope.contacts.sort(contactComparator).forEach(function(contact,index){angular.equals(contact,$scope.contact)&&($scope.contact.id=index)}),$state.go("contacts.view",{id:$scope.contact.id}))},$scope.$watch("contact.birthday",function(birthday){"view"!==$scope.action&&$scope.contact&&($scope.contact.age=$filter("age")(birthday))}),$scope.$on("$stateChangeStart",function(event,toState,params,fromState){var confirmationMessage=["Are you sure you want to leave?","NOTE: Your changes will be discarded."].join("\n\n");"contacts.edit"===fromState.name&&$scope.isContactEdited()&&!$scope.submitted&&(window.confirm(confirmationMessage)?$scope.contacts[$scope.activeContact.id]=$scope.activeContact:event.preventDefault())}),$scope.$on("$stateChangeSuccess",function(event,toState,params){var id=parseInt(params.id);id=angular.isNumber(id)?id:$scope.contacts.length,$scope.action=toState.name.split("contacts.")[1],$scope.submitted=!1,"create"===$scope.action&&($scope.activeContact={},$scope.contact={},$scope.contact.id=id),("edit"===$scope.action||"view"===$scope.action)&&($scope.contacts[id]?($scope.contact=$scope.contacts[id],$scope.contact.id=id,$scope.activeContact=angular.copy($scope.contact)):($scope.activeContact.id=void 0,$state.go("contacts")))})}]),angular.module("contacts").filter("age",["Validation",function(Validation){"use strict";function getAge(birthday){if(!Validation.date.test(birthday))return void 0;var today=new Date;return birthday=new Date(birthday),Math.floor((today-birthday)/1e3/60/60/24/365)}return getAge.bind({})}]),angular.module("contacts").filter("phone",["Validation",function(Validation){"use strict";function formatPhoneNumber(phoneNumber){return phoneNumber.replace(Validation.phone,"($1) $2-$3")}return formatPhoneNumber.bind({})}]),angular.module("contacts").value("Contacts",[{name:"Doug Stamper",sex:"male",age:49,birthday:"4/1/1964",address:{street:"77 Main St",city:"Washington",state:"DC",postcode:"20004"},phone:"555-555-5555",email:"thestamper@hotmail.com"},{name:"Francis Underwood",sex:"male",age:54,birthday:"11/5/1959",address:{street:"123 Anywhere",city:"Washington",state:"DC",postcode:"20004"},phone:"555-555-5555",email:"littlejohn@whitehouse.gov"},{name:"Zoey Barnes",sex:"female",age:26,birthday:"3/25/1987",address:{street:"456 Somewhere Else",city:"Annapolis",state:"MD",postcode:"21401"},phone:"555-555-5555",email:"zbarnes@slugline.com"}]),angular.module("contacts").value("States",[{abbr:"AL",name:"Alabama"},{abbr:"AK",name:"Alaska"},{abbr:"AZ",name:"Arizona"},{abbr:"AR",name:"Arkansas"},{abbr:"CA",name:"California"},{abbr:"CO",name:"Colorado"},{abbr:"CT",name:"Connecticut"},{abbr:"DE",name:"Delaware"},{abbr:"DC",name:"District of Columbia"},{abbr:"FL",name:"Florida"},{abbr:"GA",name:"Georgia"},{abbr:"HI",name:"Hawaii"},{abbr:"ID",name:"Idaho"},{abbr:"IL",name:"Illinois"},{abbr:"IN",name:"Indiana"},{abbr:"IA",name:"Iowa"},{abbr:"KS",name:"Kansas"},{abbr:"KY",name:"Kentucky"},{abbr:"LA",name:"Louisiana"},{abbr:"ME",name:"Maine"},{abbr:"MD",name:"Maryland"},{abbr:"MA",name:"Massachusetts"},{abbr:"MI",name:"Michigan"},{abbr:"MN",name:"Minnesota"},{abbr:"MS",name:"Mississippi"},{abbr:"MO",name:"Missouri"},{abbr:"MT",name:"Montana"},{abbr:"NE",name:"Nebraska"},{abbr:"NV",name:"Nevada"},{abbr:"NH",name:"New Hampshire"},{abbr:"NJ",name:"New Jersey"},{abbr:"NM",name:"New Mexico"},{abbr:"NY",name:"New York"},{abbr:"NC",name:"North Carolina"},{abbr:"ND",name:"North Dakota"},{abbr:"OH",name:"Ohio"},{abbr:"OK",name:"Oklahoma"},{abbr:"OR",name:"Oregon"},{abbr:"PA",name:"Pennsylvania"},{abbr:"RI",name:"Rhode Island"},{abbr:"SC",name:"South Carolina"},{abbr:"SD",name:"South Dakota"},{abbr:"TN",name:"Tennessee"},{abbr:"TX",name:"Texas"},{abbr:"UT",name:"Utah"},{abbr:"VT",name:"Vermont"},{abbr:"VA",name:"Virginia"},{abbr:"WA",name:"Washington"},{abbr:"WV",name:"West Virginia"},{abbr:"WI",name:"Wisconsin"},{abbr:"WY",name:"Wyoming"}]),angular.module("contacts").value("Validation",{date:/^\d+[-\/]\d+[-\/]\d{4}$/,phone:/^(\d{3})-*(\d{3})-*(\d{4})$/,postcode:/^\d{5}(-\d{4})?$/});